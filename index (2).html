<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Power Saver Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #fbbf24; /* Yellow */
            --secondary: #10b981; /* Green */
            --accent: #ffffff; /* White */
            --background: #f9fafb; /* Light Gray */
            --card: #ffffff; /* White */
            --text: #1f2937; /* Dark Gray */
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            min-height: 100vh;
        }
        
        .dashboard-card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        .device-card {
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            border-radius: 16px;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: var(--accent);
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 8px;
            background: var(--secondary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .savings-badge {
            background: var(--secondary);
            color: var(--accent);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: var(--primary);
            color: var(--accent);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-xl flex items-center justify-center">
                    <i class="fas fa-bolt text-black text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Smart Power Saver</h1>
                    <p class="text-gray-600">Blockchain-Powered Energy Management</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="hidden md:block">
                    <span class="text-sm text-gray-600">Last updated: Just now</span>
                </div>
                <div class="w-10 h-10 bg-gradient-to-r from-gray-600 to-gray-800 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white"></i>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="flex space-x-2 mb-6 bg-white rounded-2xl p-2">
            <a href="index.html" class="tab-button active px-6 py-3 rounded-xl font-semibold">
                <i class="fas fa-chart-line mr-2"></i>Dashboard
            </a>
            <a href="wallet.html" class="tab-button px-6 py-3 rounded-xl font-semibold">
                <i class="fas fa-wallet mr-2"></i>Digital Wallet
            </a>
            <a href="bills.html" class="tab-button px-6 py-3 rounded-xl font-semibold">
                <i class="fas fa-file-invoice mr-2"></i>Bill Payment
            </a>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard-content">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="dashboard-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Total Consumption</h3>
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-bolt text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="total-consumption">12.8 kWh</p>
                    <p class="text-sm text-gray-600 mt-2">Today's energy usage</p>
                    <div class="progress-bar mt-4">
                        <div class="progress-fill w-65%"></div>
                    </div>
                </div>

                <div class="dashboard-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Total Cost</h3>
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-rupee-sign text-green-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="total-cost">₹235.50</p>
                    <p class="text-sm text-gray-600 mt-2">Today's expenditure</p>
                    <div class="flex items-center mt-4">
                        <span class="text-green-600 text-sm font-semibold">↘️ 12% less than yesterday</span>
                    </div>
                </div>

                <div class="dashboard-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Estimated Savings</h3>
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-piggy-bank text-orange-600 text-xl"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="estimated-savings">₹78.25</p>
                    <p class="text-sm text-gray-600 mt-2">This month's savings</p>
                    <div class="savings-badge inline-block mt-4" id="carbon-saved">
                        <i class="fas fa-leaf mr-2"></i>Carbon Saved: 12.5 kg
                    </div>
                </div>
            </div>

            <!-- Blockchain Integration Section -->
            <div class="dashboard-card p-6 mb-8">
                <h3 class="text-xl font-semibold text-gray-800">Blockchain Integration</h3>
                <p class="text-gray-600 mb-4">Our system utilizes blockchain technology to ensure secure and transparent energy management. Smart contracts automate transactions and device scheduling, while providing a decentralized platform for energy trading.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-effect p-4 rounded-xl">
                        <h4 class="font-semibold">Smart Contracts</h4>
                        <p class="text-sm text-gray-600">Automated agreements that execute transactions based on predefined conditions.</p>
                    </div>
                    <div class="glass-effect p-4 rounded-xl">
                        <h4 class="font-semibold">Energy Trading</h4>
                        <p class="text-sm text-gray-600">Trade excess energy with neighbors or the grid, ensuring fair pricing and efficient energy distribution.</p>
                    </div>
                </div>
            </div>

            <!-- Transaction History Section -->
            <div class="dashboard-card p-6 mb-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Blockchain Transaction History</h3>
                <div class="space-y-4" id="blockchain-transactions">
                    <!-- Transactions loaded here by JavaScript -->
                </div>
            </div>

            <!-- Blockchain Network Health Section -->
            <div class="dashboard-card p-6 mb-8">
                <h3 class="text-xl font-semibold text-gray-800">Blockchain Network Health</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass-effect p-4 rounded-xl">
                        <h4 class="font-semibold">Block Confirmations</h4>
                        <p class="text-sm text-gray-600" id="block-confirmations">Current: 12 Confirmations</p>
                    </div>
                    <div class="glass-effect p-4 rounded-xl">
                        <h4 class="font-semibold">Transaction Speed</h4>
                        <p class="text-sm text-gray-600" id="transaction-speed">Average: 2 seconds</p>
                    </div>
                    <div class="glass-effect p-4 rounded-xl">
                        <h4 class="font-semibold">Active Nodes</h4>
                        <p class="text-sm text-gray-600" id="active-nodes">Total: 45 Nodes</p>
                    </div>
                </div>
            </div>

            <!-- Device List -->
            <div class="dashboard-card p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Connected Devices</h2>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm" id="device-count">
                        8 devices connected
                    </span>
                </div>

                <div class="space-y-4" id="device-list">
                    <!-- Devices will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to fetch data from data.json
        async function fetchData() {
            try {
                const response = await fetch('data.json'); // Path to your JSON file
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Could not fetch data:", error);
                return null; // Or handle error appropriately
            }
        }

        // --- Rendering Functions ---
        async function renderDashboard() {
            const appData = await fetchData(); // Fetch data from data.json
            if (!appData) return;

            // Update Summary Cards
            document.getElementById('total-consumption').textContent = `${appData.summary.totalConsumptionKWh} kWh`;
            document.getElementById('total-cost').textContent = `₹${appData.summary.totalCostINR.toFixed(2)}`;
            document.getElementById('estimated-savings').textContent = `₹${appData.summary.estimatedSavingsINR.toFixed(2)}`;
            document.getElementById('carbon-saved').innerHTML = `<i class="fas fa-leaf mr-2"></i>Carbon Saved: ${appData.summary.carbonSavedKg} kg`;

            // Update Blockchain Network Health
            document.getElementById('block-confirmations').textContent = `Current: ${appData.blockchain.blockConfirmations} Confirmations`;
            document.getElementById('transaction-speed').textContent = `Average: ${appData.blockchain.transactionSpeedSeconds} seconds`;
            document.getElementById('active-nodes').textContent = `Total: ${appData.blockchain.activeNodes} Nodes`;

            // Update Blockchain Transaction History
            const blockchainTransactionsContainer = document.getElementById('blockchain-transactions');
            blockchainTransactionsContainer.innerHTML = '';
            appData.transactions.forEach(txn => {
                const txnDiv = document.createElement('div');
                txnDiv.className = `transaction-item ${txn.type} p-4 ${txn.type === 'credit' ? 'bg-green-50' : 'bg-red-50'} rounded-xl`;
                txnDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 ${txn.type === 'credit' ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center">
                                <i class="fas ${txn.type === 'credit' ? 'fa-arrow-down text-green-600' : 'fa-bolt text-red-600'}"></i>
                            </div>
                            <div>
                                <p class="font-semibold">${txn.description}</p>
                                <p class="text-sm text-gray-600">${txn.details}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold ${txn.type === 'credit' ? 'text-green-600' : 'text-red-600'}">${txn.type === 'credit' ? '+' : ''}₹${txn.amountINR.toFixed(2)}</p>
                            <p class="text-sm text-gray-600">${txn.timeAgo}</p>
                        </div>
                    </div>
                `;
                blockchainTransactionsContainer.appendChild(txnDiv);
            });

            // Render Devices
            const deviceListContainer = document.getElementById('device-list');
            deviceListContainer.innerHTML = '';
            document.getElementById('device-count').textContent = `${appData.devices.length} devices connected`;

            appData.devices.forEach(device => {
                const deviceCard = document.createElement('div');
                deviceCard.className = `device-card p-4 flex items-center justify-between ${!device.status ? 'offline' : ''}`;
                deviceCard.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 ${device.status ? 'bg-blue-100' : 'bg-red-100'} rounded-xl flex items-center justify-center">
                            <i class="fas ${device.icon} ${device.status ? 'text-blue-600' : 'text-red-600'} text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">${device.name}</h3>
                            <div class="flex space-x-3 mt-1">
                                <span class="text-sm text-blue-600">${device.consumptionKWh} kWh</span>
                                <span class="text-sm text-green-600">₹${device.costINR.toFixed(2)}</span>
                                <span class="text-sm text-orange-600">${device.efficiencyPercent}% efficient</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="toggle-switch">
                            <input type="checkbox" ${device.status ? 'checked' : ''} id="toggle-${device.id}" onchange="handleDeviceToggle('${device.id}', this.checked)">
                            <label for="toggle-${device.id}" class="slider"></label>
                        </div>
                        <button class="px-3 py-2 bg-gray-100 rounded-lg text-sm" onclick="startScheduleEdit('${device.id}')">
                            <i class="fas fa-clock mr-1"></i>${device.schedule}
                        </button>
                    </div>
                `;
                deviceListContainer.appendChild(deviceCard);
            });
        }

        function getDeviceIcon(deviceName) {
            // This function is now less critical as icons are in data.json,
            // but kept for consistency or if data.json doesn't provide it.
            switch (deviceName) {
                case 'Living Room AC': return 'fa-snowflake';
                case 'Refrigerator': return 'fa-blender';
                case 'Washing Machine': return 'fa-tshirt';
                case 'Water Heater': return 'fa-water';
                case 'Smart Lights': return 'fa-lightbulb';
                case 'Dishwasher': return 'fa-dishwasher';
                default: return 'fa-plug';
            }
        }

        // --- Conceptual Aptos Transaction Calls (Alerts remain) ---
        async function handleDeviceToggle(deviceId, newStatus) {
            const statusText = newStatus ? 'ON' : 'OFF';
            alert(`Simulating Aptos Transaction:\nCalling DeviceManager::toggle_device_status('${deviceId}', ${newStatus}).\nThis would require wallet confirmation.`);
            // In a real app, you'd send a transaction to Aptos here.
            // For now, re-render to simulate local state change (though data.json won't update)
            renderDashboard();
        }

        async function startScheduleEdit(deviceId) {
            alert(`Simulating Aptos Transaction:\nCalling DeviceManager::update_device_schedule('${deviceId}', new_schedule_data).\nThis would require wallet confirmation.`);
            // In a real app, you'd send a transaction to Aptos here for schedule update
            renderDashboard();
        }

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', renderDashboard);
    </script>
</body>
</html>
